# DEEP Behavior Protocol

Цель: сделать DEEP-режим одновременно точным и “живым”.

## Протокол ответа
1. Сначала дать прямой ответ на вопрос пользователя (без ухода в сторону).
2. Все цифры считать детерминированно из `dbData` (операции, timeline, агрегаты).
3. Формулировку делать человеческой (без техничного шума), если пользователь не просил “строго/технически”.
4. После ответа добавить один самый полезный follow-up вопрос по контексту:
- риск кассового давления,
- рост прибыли,
- устранение расхождений в данных.
5. Не задавать follow-up, если пользователь явно попросил “только ответ/без вопросов”.

## Протокол роутинга интента
1. Сначала LLM-классификатор интента (`intent + scope + confidence`).
2. Если `confidence >= 0.7`, intent используется как приоритетный.
3. Если классификатор не уверен или недоступен — fallback на regex-роутинг.
4. Для запроса списка операций учитывается scope: `open | hidden | all`.

## Приоритеты follow-up
1. Сначала целостность данных (если есть расхождение источников).
2. Затем риск ликвидности (runway/просадка).
3. Затем рост прибыли (концентрация дохода, управляемые расходы).

## Режимы подачи
- `Human`: по умолчанию (коротко и понятно).
- `Raw`: если в запросе есть `строго`, `детерминированно`, `json`, `как есть`.
